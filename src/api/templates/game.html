<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Game</title>

    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='main.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='game.css') }}">
</head>
<body>
<div class="main-game-box">
    <div class="word">
        <p class="char"></p>
        <p class="char"></p>
        <p class="char"></p>
        <p class="char"></p>
        <p class="char"></p>
    </div>
    <div class="word">
        <p class="char"></p>
        <p class="char"></p>
        <p class="char"></p>
        <p class="char"></p>
        <p class="char"></p>
    </div>
    <div class="word">
        <p class="char"></p>
        <p class="char"></p>
        <p class="char"></p>
        <p class="char"></p>
        <p class="char"></p>
    </div>
    <div class="word">
        <p class="char"></p>
        <p class="char"></p>
        <p class="char"></p>
        <p class="char"></p>
        <p class="char"></p>
    </div>
    <div class="word">
        <p class="char"></p>
        <p class="char"></p>
        <p class="char"></p>
        <p class="char"></p>
        <p class="char"></p>
    </div>
    <div class="word">
        <p class="char"></p>
        <p class="char"></p>
        <p class="char"></p>
        <p class="char"></p>
        <p class="char"></p>
    </div>
</div>

<script>
    let words = {
        letters: [[]],
        patterns: [[]]
    }
    let currentList = "letters"
    const WordsModes = {
        Letters: "letters",
        Patterns: "patterns"
    }
    const PatternColors = {
        "0": "#3a3a3c",
        "1": "#b59f3b",
        "2": "#538d4e",
        "": "#121213"
    }

    let charBoxes = document.querySelectorAll(".char")
    let selectedChar = 0

    charBoxes[selectedChar].classList.add("selected")
    
    function updateSelectedChar(n=1) {
        charBoxes[selectedChar].classList.remove("selected")
        selectedChar += n
        charBoxes[selectedChar].classList.add("selected")
    }
    
    function updateSelectedHtml(index, value) {
        if (currentList === WordsModes.Letters) {
            charBoxes[index].innerHTML = value
        } else if (currentList === WordsModes.Patterns){
            charBoxes[index].style.backgroundColor = PatternColors[value]
        }
    }

    const allowedLetters = {
        letters: ['q', 'w', 'e', 'r', 't', 'y', 'u', 'i', 'o', 'p', 'a', 's', 'd', 'f', 'g', 'h', 'j', 'k', 'l', 'z', 'x', 'c', 'v', 'b', 'n', 'm', 'ę', 'ó', 'ą', 'ś', 'ł', 'ż', 'ź', 'ć'],
        patterns: ['0', '1', '2']
    }
    document.addEventListener("keypress", (e) => {
        let typedLetter = e.key.toLowerCase()
        
        if (allowedLetters[currentList].includes(typedLetter)) {
            updateSelectedHtml(selectedChar, typedLetter.toLocaleUpperCase())
            words[currentList][words[currentList].length - 1][selectedChar % 5] = typedLetter
            
            if (selectedChar < 5 * (words[currentList].length) - 1) {
                updateSelectedChar()
            }
        }
        
        if (typedLetter === "enter") {
            if (words[currentList][words[currentList].length - 1].length === 5) {
                words[currentList].push([])
                if (words.letters.length !== words.patterns.length) {
                    currentList = WordsModes.Patterns
                    updateSelectedChar(-4)
                } else {
                    currentList = WordsModes.Letters
                    updateSelectedChar()
                }
            }
        }
        
        if (typedLetter === "backspace") {
            if (selectedChar % 5 > 0 && (charBoxes[selectedChar].innerHTML === "" || currentList === WordsModes.Patterns)) {
                updateSelectedHtml(selectedChar - 1, "")
                words[currentList][words[currentList].length - 1].pop()
                updateSelectedChar(-1)
            } else if (selectedChar % 5 === 4) {
                updateSelectedHtml(selectedChar, "")
                words[currentList][words[currentList].length - 1].pop()
            }
        }
    })
</script>
</body>
</html>
